<view class="customer-page">
  <!-- æœç´¢å’Œæ–°å¢åŒºåŸŸ -->
  <view class="search-add-bar">
    <view class="search-box always-show">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢å®¢æˆ·å§“å" 
        value="{{searchValue}}" 
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
    </view>
    <view class="icon-btn add-icon-btn" bindtap="showAddModal">
      <text class="icon">â•</text>
    </view>
  </view>

  <!-- å®¢æˆ·åˆ—è¡¨ -->
  <view class="customer-list">
    <view wx:if="{{customerList.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ‘¤</text>
      <text class="empty-text">æš‚æ— å®¢æˆ·æ•°æ®</text>
      <text class="empty-tip">ç‚¹å‡»"+"æŒ‰é’®æ·»åŠ å®¢æˆ·</text>
    </view>

    <block wx:for="{{customerList}}" wx:key="id">
      <view class="customer-item card">
        <view class="customer-info">
          <view class="customer-basic">
            <text class="customer-name">{{item.name}}</text>
            <view class="customer-tags">
              <text wx:if="{{item.gender}}" class="customer-tag gender">{{item.gender}}</text>
              <text wx:if="{{item.vipLevel}}" class="customer-tag vip">{{item.vipLevel}}</text>
              <text wx:if="{{item.source}}" class="customer-tag source">{{item.source}}</text>
            </view>
          </view>
          
          <view class="customer-contact">
            <text class="contact-item">ğŸ“± {{item.phone}}</text>
            <text wx:if="{{item.wechat}}" class="contact-item">ğŸ’¬ {{item.wechat}}</text>
          </view>
          
          <view wx:if="{{item.lastVisit}}" class="customer-details">
            <text class="detail-item">æœ€è¿‘æ¶ˆè´¹: {{item.lastVisit}}</text>
            <text wx:if="{{item.totalConsumption}}" class="detail-item">ç´¯è®¡æ¶ˆè´¹: Â¥{{item.totalConsumption}}</text>
          </view>
          
          <text wx:if="{{item.remark}}" class="customer-remark">{{item.remark}}</text>
        </view>
        
        <view class="customer-actions">
          <view class="action-btn edit" data-id="{{item.id}}" bindtap="editCustomer">
            <text class="action-icon">âœï¸</text>
            <text class="action-text">ç¼–è¾‘</text>
          </view>
          <view class="action-btn delete" data-id="{{item.id}}" bindtap="deleteCustomer">
            <text class="action-icon">ğŸ—‘ï¸</text>
            <text class="action-text">åˆ é™¤</text>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{hasMore}}" class="load-more" bindtap="loadMore">
    <text>{{loading ? 'åŠ è½½ä¸­...' : 'ç‚¹å‡»åŠ è½½æ›´å¤š'}}</text>
  </view>
  <view wx:else class="no-more">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>

  <!-- æ–°å¢/ç¼–è¾‘å®¢æˆ·å¼¹çª— -->
  <view class="modal" wx:if="{{showModal}}">
    <view class="modal-mask" bindtap="hideModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{isEdit ? 'ç¼–è¾‘å®¢æˆ·' : 'æ–°å¢å®¢æˆ·'}}</text>
        <text class="close-icon" bindtap="hideModal">âœ•</text>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label required">å®¢æˆ·å§“å</text>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥å®¢æˆ·å§“å" 
            value="{{formData.name}}"
            bindinput="onFormInput"
            data-field="name"
          />
        </view>
        
        <view class="form-item">
          <text class="form-label required">æ‰‹æœºå·</text>
          <input 
            class="form-input" 
            type="number" 
            placeholder="è¯·è¾“å…¥æ‰‹æœºå·" 
            value="{{formData.phone}}"
            bindinput="onFormInput"
            data-field="phone"
            maxlength="11"
          />
        </view>
        
        <view class="form-item">
          <text class="form-label">å¾®ä¿¡å·</text>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥å¾®ä¿¡å·" 
            value="{{formData.wechat}}"
            bindinput="onFormInput"
            data-field="wechat"
          />
        </view>
        
        <view class="form-row">
          <view class="form-item-half">
            <text class="form-label">æ€§åˆ«</text>
            <picker 
              range="{{genders}}" 
              value="{{genderIndex}}"
              bindchange="onGenderChange"
            >
              <view class="form-input picker-input">
                {{formData.gender || 'è¯·é€‰æ‹©æ€§åˆ«'}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
          
          <view class="form-item-half">
            <text class="form-label">ç”Ÿæ—¥</text>
            <picker 
              mode="date" 
              value="{{formData.birthday}}"
              bindchange="onBirthdayChange"
            >
              <view class="form-input picker-input">
                {{formData.birthday || 'è¯·é€‰æ‹©ç”Ÿæ—¥'}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
        </view>
        
        <view class="form-row">
          <view class="form-item-half">
            <text class="form-label">å®¢æˆ·ç­‰çº§</text>
            <picker 
              range="{{vipLevels}}" 
              value="{{vipLevelIndex}}"
              bindchange="onVipLevelChange"
            >
              <view class="form-input picker-input">
                {{formData.vipLevel || 'è¯·é€‰æ‹©ç­‰çº§'}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
          
          <view class="form-item-half">
            <text class="form-label">å®¢æˆ·æ¥æº</text>
            <picker 
              range="{{sources}}" 
              value="{{sourceIndex}}"
              bindchange="onSourceChange"
            >
              <view class="form-input picker-input">
                {{formData.source || 'è¯·é€‰æ‹©æ¥æº'}}
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">æœ€è¿‘æ¶ˆè´¹</text>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥æœ€è¿‘æ¶ˆè´¹æ—¥æœŸ" 
            value="{{formData.lastVisit}}"
            bindinput="onFormInput"
            data-field="lastVisit"
          />
        </view>
        
        <view class="form-item">
          <text class="form-label">ç´¯è®¡æ¶ˆè´¹</text>
          <input 
            class="form-input" 
            type="number" 
            placeholder="è¯·è¾“å…¥ç´¯è®¡æ¶ˆè´¹é‡‘é¢" 
            value="{{formData.totalConsumption}}"
            bindinput="onFormInput"
            data-field="totalConsumption"
          />
        </view>
        
        <view class="form-item">
          <text class="form-label">å®¢æˆ·å¤‡æ³¨</text>
          <textarea 
            class="form-textarea" 
            placeholder="è¯·è¾“å…¥å®¢æˆ·å¤‡æ³¨ä¿¡æ¯" 
            value="{{formData.remark}}"
            bindinput="onFormInput"
            data-field="remark"
            maxlength="200"
          />
          <text class="form-tip">{{formData.remark ? formData.remark.length : 0}}/200</text>
        </view>
      </view>
      
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="hideModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm" bindtap="saveCustomer">ä¿å­˜</view>
      </view>
    </view>
  </view>
</view>