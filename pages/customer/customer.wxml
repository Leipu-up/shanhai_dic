<view class="customer-page">
    <!-- цРЬч┤вхТМцЦ░хвЮхМ║хЯЯ -->
    <view class="search-add-bar">
        <view class="search-box always-show">
            <input class="search-input" placeholder="цРЬч┤вховцИ╖хзУхРН" value="{{searchValue}}" bindinput="onSearchInput"/>
            <text class="search-icon" bindtap="onSearchConfirm" >ЁЯФН</text>
        </view>
    </view>

    <!-- ховцИ╖хИЧшби -->
    <view class="customer-list">
        <view wx:if="{{customerList.length === 0}}" class="empty-state">
            <text class="empty-icon">ЁЯСд</text>
            <text class="empty-text">цЪВцЧаховцИ╖цХ░цНо</text>
            <text class="empty-tip">чВ╣хЗ╗"+"цМЙщТоц╖╗хКаховцИ╖</text>
        </view>

        <block wx:for="{{customerList}}" wx:key="id" >
            <view class="customer-item card" bindtap="viewCustomer" data-id="{{item.id}}">
                <view class="customer-info">
                    <view class="customer-basic">
                        <text class="customer-name">{{item.khxm}}</text>
                        <view class="customer-tags">
                            <text wx:if="{{item.khxb}}" class="customer-tag gender">{{item.khxb}}</text>
                            <text wx:if="{{item.khdj}}" class="customer-tag vip">{{item.khdj}}</text>
                            <text wx:if="{{item.khly}}" class="customer-tag source">{{item.khly}}</text>
                        </view>
                    </view>

                    <view class="customer-contact">
                        <text class="contact-item">ЁЯУ▒ {{item.khsjh}}</text>
                    </view>

                    <view wx:if="{{item.ljxf}}" class="customer-details">
                        <text class="detail-item">ч┤пшобц╢Иш┤╣:  ┬е{{item.ljxf}}</text>
                    </view>
                    <text wx:if="{{item.bz}}" class="customer-remark">{{item.bz}}</text>
                </view>

                <view class="customer-actions">
                    <view class="action-btn edit" data-id="{{item.id}}" catchtap="editCustomer">
                        <text class="action-icon">тЬПя╕П</text>
                        <text class="action-text">ч╝Цш╛С</text>
                    </view>
                    <view class="action-btn delete" data-id="{{item.id}}" catchtap="deleteCustomer">
                        <text class="action-icon">ЁЯЧСя╕П</text>
                        <text class="action-text">хИащЩд</text>
                    </view>
                </view>
            </view>
        </block>
    </view>

    <!-- хКаш╜╜чК╢цАБцПРчд║ -->
    <view class="loading-status">
        <view wx:if="{{loading && hasMore}}" class="loading-content">
            <text>хКаш╜╜ф╕н...</text>
        </view>
        <text wx:if="{{!hasMore && customerList.length > 0 && !loading}}" class="no-more-text">ц▓бцЬЙцЫ┤хдЪф║Ж</text>
    </view>

    <!-- чй║чК╢цАБцПРчд║ -->
    <view wx:if="{{customerList.length === 0 && !loading}}" class="empty-state">
        <text class="empty-text">цЪВцЧаховцИ╖цХ░цНо</text>
    </view>

    <!-- цЦ░хвЮховцИ╖цМЙщТо -->
    <view class="add-btn-container">
        <button class="add-btn" bindtap="showAddModal">
            <text class="add-icon">+</text>
            <text class="add-text">цЦ░хвЮховцИ╖</text>
        </button>
    </view>


    <!-- цЦ░хвЮ/ч╝Цш╛СховцИ╖х╝╣чкЧ -->
    <view class="modal" wx:if="{{showModal}}">
        <view class="modal-mask" bindtap="hideModal"></view>
        <view class="modal-content">
            <view class="modal-header">
                <text class="modal-title">{{isView? 'цЯечЬЛховцИ╖': (isEdit ? 'ч╝Цш╛СховцИ╖' : 'цЦ░хвЮховцИ╖')}}</text>
                <text class="close-icon" bindtap="hideModal">тЬХ</text>
            </view>

            <view class="modal-body">
                <view class="form-item">
                    <text class="form-label required">ховцИ╖хзУхРН</text>
                    <input class="form-input" placeholder="шп╖ш╛УхЕеховцИ╖хзУхРН" value="{{formData.khxm}}" bindinput="onFormInput"
                        data-field="khxm" disabled="{{isView}}"/>
                </view>

                <view class="form-item">
                    <text class="form-label required">цЙЛцЬ║хП╖</text>
                    <input class="form-input" type="number" placeholder="шп╖ш╛УхЕецЙЛцЬ║хП╖" value="{{formData.khsjh}}"
                        bindinput="onFormInput" data-field="khsjh" maxlength="11"  disabled="{{isView}}"/>
                </view>

                <view class="form-row">
                    <view class="form-item-half">
                        <text class="form-label">цАзхИл</text>
                        <picker range="{{genders}}" value="{{khxb}}"
                         bindchange="onGenderChange" disabled="{{isView}}">
                            <view class="form-input picker-input">
                                {{formData.khxb || 'шп╖щАЙцЛйцАзхИл'}}
                                <text class="picker-arrow">тЦ╝</text>
                            </view>
                        </picker>
                    </view>

                    <view class="form-item-half">
                        <text class="form-label">чФЯцЧе</text>
                        <picker mode="date" value="{{formData.khsr}}" 
                        bindchange="onBirthdayChange" disabled="{{isView}}">
                            <view class="form-input picker-input">
                                {{formData.khsr || 'шп╖щАЙцЛйчФЯцЧе'}}
                                <text class="picker-arrow">тЦ╝</text>
                            </view>
                        </picker>
                    </view>
                </view>

                <view class="form-row">
                    <view class="form-item-half">
                        <text class="form-label">ховцИ╖чнЙч║з</text>
                        <picker range="{{vipLevels}}" value="{{formData.khdj}}"
                         bindchange="onVipLevelChange" disabled="{{isView}}">
                            <view class="form-input picker-input">
                                {{formData.khdj || 'шп╖щАЙцЛйчнЙч║з'}}
                                <text class="picker-arrow">тЦ╝</text>
                            </view>
                        </picker>
                    </view>

                    <view class="form-item-half">
                        <text class="form-label">ховцИ╖цЭец║Р</text>
                        <picker range="{{sources}}" value="{{formData.khly}}"
                         bindchange="onSourceChange" disabled="{{isView}}">
                            <view class="form-input picker-input">
                                {{formData.khly || 'шп╖щАЙцЛйцЭец║Р'}}
                                <text class="picker-arrow">тЦ╝</text>
                            </view>
                        </picker>
                    </view>
                </view>

                <view class="form-item">
                    <text class="form-label">ч┤пшобц╢Иш┤╣</text>
                    <input class="form-input" placeholder="шп╖ш╛УхЕеч┤пшобц╢Иш┤╣" value="{{formData.ljxf}}"
                        bindinput="onFormInput" data-field="ljxf" disabled="{{isView}}"/>
                </view>

                <view class="form-item">
                    <text class="form-label">ховцИ╖хдЗц│и</text>
                    <textarea class="form-textarea" placeholder="шп╖ш╛УхЕеховцИ╖хдЗц│иф┐бцБп" value="{{formData.bz}}"
                        bindinput="onFormInput" data-field="bz" maxlength="200" disabled="{{isView}}"/>
                    <text class="form-tip">{{formData.bz ? formData.bz.length : 0}}/200</text>
                </view>
            </view>

            <view class="modal-footer" wx:if="{{!isView}}">
                <view class="modal-btn cancel" bindtap="hideModal">хПЦц╢И</view>
                <view class="modal-btn confirm" bindtap="saveCustomer">ф┐ЭхнШ</view>
            </view>
            <!-- цЯечЬЛцибх╝Пф╕ЛчЪДхЕ│щЧнцМЙщТоя╝ИхПпщАЙя╝Й -->
            <view class="modal-footer" wx:if="{{isView}}">
                <button class="modal-btn cancel" bindtap="hideModal">хЕ│щЧн</button>
            </view>
        </view>
    </view>
</view>