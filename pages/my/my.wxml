<view class="my-page">
    <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
    <view class="user-header">
        <view class="user-info">
            <image class="avatar" src="{{userInfo.avatar || '/images/default-avatar.png'}}"></image>
            <view class="user-details">
                <text class="user-name">{{userInfo.nickName || 'è¯·ç™»å½•'}}</text>
                <text class="user-role">{{userInfo.roleText||'æ¸¸å®¢'}}</text>
                <text class="user-id">å·¥å·: {{userInfo.employeeNo || ''}}</text>
            </view>
        </view>
        <view class="edit-btn" bindtap="toEdit" wx:if="{{userInfo.userId}}">
            <text class="edit-text">ç¼–è¾‘</text>
            <text class="arrow">â€º</text>
        </view>
        <view class="edit-btn" bindtap="toLogin" wx:if="{{!userInfo.userId}}">
            <text class="edit-text">ç™»å½•</text>
            <text class="arrow">â€º</text>
        </view>
    </view>

    <!-- ä¸ªäººç»Ÿè®¡ -->
    <view class="personal-stats card">
        <view class="stats-item">
            <text class="stats-number">{{personalStats.monthlyPerformance}}</text>
            <text class="stats-label">æœ¬æœˆç›®æ ‡(å…ƒ)</text>
        </view>
        <view class="stats-item">
            <text class="stats-number">{{personalStats.monthlyPerformance}}</text>
            <text class="stats-label">æœ¬æœˆä¸šç»©(å…ƒ)</text>
        </view>
        <view class="stats-item">
            <text class="stats-number">{{personalStats.customerCount}}</text>
            <text class="stats-label">æœåŠ¡å®¢æˆ·</text>
        </view>
        <view class="stats-item">
            <text class="stats-number">{{personalStats.attendanceDays}}/31</text>
            <text class="stats-label">æœ¬æœˆå‡ºå‹¤(å¤©)</text>
        </view>
    </view>

    <!-- åŠŸèƒ½èœå• -->
    <view class="menu-section">
        <view class="section-title">æˆ‘çš„åŠŸèƒ½</view>
        <view class="menu-list">
            <view class="menu-item" bindtap="navigateToMySchedule">
                <view class="menu-icon schedule">ğŸ“…</view>
                <text class="menu-text">æˆ‘çš„æ’ç­</text>
                <view class="menu-right">
                    <text class="menu-desc">{{nextSchedule}}</text>
                    <text class="arrow">â€º</text>
                </view>
            </view>

            <view class="menu-item" bindtap="navigateToMyCustomers">
                <view class="menu-icon customers">ğŸ‘¥</view>
                <text class="menu-text">ä»Šæ—¥å®¢æˆ·</text>
                <view class="menu-right">
                    <text class="badge" wx:if="{{unreadMessages > 0}}">{{unreadMessages}}</text>
                    <text class="arrow">â€º</text>
                </view>
            </view>

        </view>
    </view>

    <!-- ç³»ç»Ÿè®¾ç½® -->
    <view class="menu-section">
        <view class="section-title">ç³»ç»Ÿè®¾ç½®</view>
        <view class="menu-list">
            <view class="menu-item">
                <view class="menu-icon about">â°</view>
                <text class="menu-text">æœ€åç™»å½•</text>
                <view class="menu-right">
                    <text class="menu-desc">{{lastLoginTime}}</text>
                    <text class="arrow">â€º</text>
                </view>
            </view>

            <view class="menu-item" bindtap="contactCustomerService">
                <view class="menu-icon help">ğŸ“</view>
                <text class="menu-text">è”ç³»å®¢æœ</text>
                <view class="menu-right">
                    <text class="menu-desc">189157555120</text>
                    <text class="arrow">â€º</text>
                </view>
            </view>

            <view class="menu-item" bindtap="showAbout">
                <view class="menu-icon about">â„¹ï¸</view>
                <text class="menu-text">å…³äºæˆ‘ä»¬</text>
                <text class="arrow">â€º</text>
            </view>

        </view>
    </view>

    <!-- é€€å‡ºç™»å½• -->
    <view class="logout-section">
        <button class="logout-btn" bindtap="logout" wx:if="{{userInfo.userId}}">é€€å‡ºç™»å½•</button>
        <button class="login-btn" bindtap="toLogin" wx:else>ç«‹å³ç™»å½•</button>
    </view>

    <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
    <view class="version-info">
        <text>v1.0.0</text>
    </view>
</view>

<!-- ç™»å½•å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showLoginModal}}" bindtap="">
    <view class="add-modal" catchtap="">
        <view class="modal-header">
            <text class="modal-title">ç™»å½•</text>
            <text class="close-btn" bindtap="closeLoginModal">Ã—</text>
        </view>

        <view class="modal-content">
            <view class="form-item">
                <text class="form-label">æ‰‹æœºå·ï¼š</text>
                <input class="form-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="{{phone}}" data-field="phone"
                    bindinput="onFormInput" />
            </view>
        </view>
        <view class="modal-content">
            <view class="form-item">
                <text class="form-label">ç™»å½•å¯†ç (6ä½)ï¼š</text>
                <input class="form-input" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç " value="{{password}}" data-field="password"
                    bindinput="onFormInput" />
            </view>
        </view>
        <view class="modal-actions">
            <button class="action-btn cancel-btn" bindtap="closeLoginModal">å–æ¶ˆ</button>
            <button class="action-btn save-btn" bindtap="checkUser">ç™»å½•</button>
        </view>
    </view>
</view>

<!-- ç¼–è¾‘å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showEditModal}}" bindtap="">
    <view class="add-modal" catchtap="">
        <view class="modal-header">
            <text class="modal-title">ç¼–è¾‘</text>
            <text class="close-btn" bindtap="closeEditModal">Ã—</text>
        </view>
        <view class="modal-content">
            <view class="form-item">
                <button class="btn" open-type="chooseAvatar" bindchooseavatar="choosePhoto">
                    <image src="{{editAvatarUrl}}" class="photo" />
                </button>
            </view>
            <view class="form-item">
                <text class="form-label">æ˜µç§°ï¼š</text>
                <input class="input" type="nickname" placeholder="è¾“å…¥æˆ–è·å–æ˜µç§°" model:value="{{userInfo.nickName}}" 
                bindinput="onFormInput" data-field="editName"/>
            </view>
            <view class="form-item">
                <text class="form-label">æ‰‹æœºå·ï¼š</text>
                <input class="form-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="{{userInfo.phoneNumber}}" data-field="editPhone"
                    bindinput="onFormInput" />
            </view>
            <view class="form-item">
                <text class="form-label">ç™»å½•å¯†ç ï¼š</text>
                <input class="form-input" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç ï¼š" value="{{userInfo.password}}" data-field="editPassword"
                    bindinput="onFormInput" />
            </view>
        </view>
        <view class="modal-actions">
            <button class="action-btn cancel-btn" bindtap="closeEditModal">å–æ¶ˆ</button>
            <button class="action-btn save-btn" bindtap="updateUser">ä¿å­˜</button>
        </view>
    </view>
</view>