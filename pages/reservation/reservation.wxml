<view class="customer-page">
    <!-- ç´§å‡‘å‹ç­›é€‰æ  -->
    <view class="filter-bar compact">
        <!-- ç¬¬ä¸€è¡Œï¼šæ—¥æœŸèŒƒå›´ -->
        <view class="filter-row compact">
            <view class="filter-item date-item">
                <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
                    <view class="date-picker compact">
                        <text class="date-icon">ğŸ“…</text>
                        <text class="date-text">{{startDate ? startDate : 'å¼€å§‹æ—¥æœŸ'}}</text>
                    </view>
                </picker>
            </view>
            <view class="filter-item date-item">
                <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
                    <view class="date-picker compact">
                        <text class="date-icon">ğŸ“…</text>
                        <text class="date-text">{{endDate ? endDate : 'ç»“æŸæ—¥æœŸ'}}</text>
                    </view>
                </picker>
            </view>
        </view>
        <!-- ç¬¬äºŒè¡Œï¼šå‘˜å·¥å’ŒçŠ¶æ€ç­›é€‰ -->
        <view class="filter-row compact">
            <view class="filter-item">
                <picker mode="selector" range="{{staffOptions}}" range-key="name" value="{{selectedStaffIndex}}"
                    bindchange="onStaffChange">
                    <view class="filter-select compact">
                        <text class="filter-icon">ğŸ‘©â€ğŸ’¼</text>
                        <text class="filter-text">{{selectedStaffName || 'å…¨éƒ¨å‘˜å·¥'}}</text>
                    </view>
                </picker>
            </view>
            <view class="filter-item">
                <picker mode="selector" range="{{statusOptions}}" range-key="name" value="{{selectedStatusIndex}}"
                    bindchange="onStatusChange">
                    <view class="filter-select compact">
                        <text class="filter-icon">ğŸ“Š</text>
                        <text class="filter-text">{{selectedStatusName || 'å…¨éƒ¨çŠ¶æ€'}}</text>
                    </view>
                </picker>
            </view>
            <!-- ç¬¬ä¸‰è¡Œï¼šæŸ¥è¯¢å’Œé‡ç½®æŒ‰é’®ï¼ˆè¿˜åŸä¸ºåŸå…ˆæ ·å¼ï¼‰ -->
            <view class="filter-row compact button-row">
                <button class="btn-reset original" bindtap="resetFilters">
                    <text class="btn-icon">ğŸ”„</text>
                    <text class="btn-text">é‡ç½®</text>
                </button>
                <button class="btn-search original" bindtap="onSearchConfirm">
                    <text class="btn-icon">ğŸ”</text>
                    <text class="btn-text">æŸ¥è¯¢</text>
                </button>
            </view>
        </view>
    </view>

    <!-- å®¢æˆ·åˆ—è¡¨ -->
    <view class="customer-list compact">
        <!-- åˆ—è¡¨æ ‡é¢˜å’Œåˆ†é¡µä¿¡æ¯ -->
        <view class="list-header compact">
            <view class="list-title-section">
                <text class="list-title">é¢„çº¦åˆ—è¡¨</text>
                <text class="list-count" wx:if="{{total > 0}}">{{currentPage}}/{{pageCount}} é¡µï¼Œå…± {{total}}
                    æ¡</text>
                <text class="list-count" wx:else>æš‚æ— æ•°æ®</text>
            </view>
        </view>

        <view wx:if="{{customerList.length > 0}}">
            <!-- å®¢æˆ·åˆ—è¡¨é¡¹ - ç®€åŒ–ç‰ˆæœ¬ -->
            <view class="customer-item compact" wx:for="{{customerList}}" wx:key="id" bindtap="showDetailModal"
                data-index="{{index}}">
                <view class="customer-main-info">
                    <view class="customer-basic">
                        <text class="customer-name">{{item.jmkhb.khxm}}</text>
                        <text class="customer-phone">{{item.jmkhb.khsjh}}</text>
                    </view>
                    <view class="appointment-time-info">
                        <view class="time-item">
                            <text class="time-icon">ğŸ“…</text>
                            <text class="time-text">{{item.yyrq}}</text>
                        </view>
                        <view class="time-item">
                            <text class="time-icon">â°</text>
                            <text class="time-text">{{item.yysj}}</text>
                        </view>
                    </view>
                    <view class="appointment-staff-info">
                        <view class="staff-item">
                            <text class="staff-icon">ğŸ‘©â€ğŸ’¼</text>
                            <text class="staff-text">{{item.jmygb.nickname}}</text>
                        </view>
                        <view class="status-badge {{item.zt=='å¾…æœåŠ¡'?'pending':
                        (item.zt=='æœåŠ¡ä¸­'?'confirmed':
                        (item.zt=='å·²æœåŠ¡'?'completed':
                        (item.zt=='å·²è¶…æ—¶'?'timeout':'cancelled')))}}">
                            {{item.zt}}
                        </view>
                    </view>
                </view>
            </view>

            <!-- åˆ†é¡µåŠ è½½æç¤º -->
            <view class="load-more-container">
                <view wx:if="{{isLoading}}" class="loading-more">
                    <view class="loading-spinner"></view>
                    <text class="loading-text">æ­£åœ¨åŠ è½½...</text>
                </view>
                <view wx:if="{{!hasMore && totalCount > 0}}" class="no-more-data">
                    <text class="no-more-text">å·²åŠ è½½å…¨éƒ¨æ•°æ®</text>
                </view>
                <view wx:if="{{hasMore && !isLoading}}" class="load-more-tip">
                    <text class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
                </view>
            </view>
        </view>

        <view wx:else class="empty-state compact">
            <view class="empty-icon">ğŸ“…</view>
            <text class="empty-text">æš‚æ— é¢„çº¦è®°å½•</text>
            <button class="btn-primary compact" bindtap="showAddModal">+ æ–°å¢é¢„çº¦</button>
        </view>
    </view>

    <!-- æ–°å¢é¢„çº¦æŒ‰é’® -->
    <view class="add-btn-container" wx:if="{{customerList.length > 0}}">
        <button class="add-btn" bindtap="showAddModal">
            <text class="add-icon">+</text>
            <text class="add-text">æ–°å¢é¢„çº¦</text>
        </button>
    </view>

    <!-- è¯¦æƒ…å¼¹çª— -->
    <view class="detail-modal" wx:if="{{showDetailModal}}">
        <view class="modal-mask" bindtap="hideDetailModal"></view>
        <view class="modal-content compact">
            <view class="modal-header">
                <text class="modal-title">é¢„çº¦è¯¦æƒ…</text>
                <text class="close-btn" bindtap="hideDetailModal">Ã—</text>
            </view>
            <scroll-view class="modal-body" scroll-y>
                <view class="detail-section">
                    <view class="detail-row">
                        <text class="detail-label">å®¢æˆ·å§“åï¼š</text>
                        <text class="detail-value">{{currentDetail.jmkhb.khxm}}</text>
                    </view>
                    <view class="detail-row">
                        <text class="detail-label">æ‰‹æœºå·ï¼š</text>
                        <text class="detail-value">{{currentDetail.jmkhb.khsjh}}</text>
                    </view>
                    <view class="detail-row">
                        <text class="detail-label">é¢„çº¦æ—¥æœŸï¼š</text>
                        <text class="detail-value">{{currentDetail.yyrq}}</text>
                    </view>
                    <view class="detail-row">
                        <text class="detail-label">é¢„çº¦æ—¶é—´ï¼š</text>
                        <text class="detail-value">{{currentDetail.yysj}}</text>
                    </view>
                    <view class="detail-row">
                        <text class="detail-label">æœåŠ¡é¡¹ç›®ï¼š</text>
                        <text class="detail-value">{{currentDetail.jmfwb.fwmc}}</text>
                    </view>
                    <view class="detail-row">
                        <text class="detail-label">æœåŠ¡æ—¶é•¿ï¼š</text>
                        <text class="detail-value">{{currentDetail.jmfwb.fwsc}}åˆ†é’Ÿ</text>
                    </view>
                    <view class="detail-row">
                        <text class="detail-label">æœåŠ¡äººå‘˜ï¼š</text>
                        <text class="detail-value">{{currentDetail.jmygb.nickname}}</text>
                    </view>
                    <view class="detail-row">
                        <text class="detail-label">é¢„çº¦çŠ¶æ€ï¼š</text>
                        <view class="detail-status  {{item.zt=='å¾…æœåŠ¡'?'pending':
                        (item.zt=='æœåŠ¡ä¸­'?'confirmed':
                        (item.zt=='å·²æœåŠ¡'?'completed':
                        (item.zt=='å·²è¶…æ—¶'?'timeout':'cancelled')))}}">
                            {{currentDetail.zt}}
                        </view>
                    </view>
                    <view class="detail-row" wx:if="{{currentDetail.bz}}">
                        <text class="detail-label">å¤‡æ³¨ï¼š</text>
                        <text class="detail-value">{{currentDetail.bz}}</text>
                    </view>
                </view>
            </scroll-view>
            <view class="modal-footer compact">
                <button class="btn-gb" wx:if="{{currentDetail.zt === 'å·²å–æ¶ˆ' || currentDetail.zt === 'å·²è¶…æ—¶'
                    || currentDetail.zt === 'å·²æœåŠ¡' || currentDetail.zt === 'æœåŠ¡ä¸­'}}"
                    bindtap="hideDetailModal">å…³é—­</button>
                <button class="btn-edit" wx:if="{{currentDetail.zt === 'å¾…æœåŠ¡'}}"
                    bindtap="editCurrentAppointment">ç¼–è¾‘</button>
                <button class="btn-cancel" wx:if="{{currentDetail.zt === 'å¾…æœåŠ¡'||currentDetail.zt === 'æœåŠ¡ä¸­'}}"
                    bindtap="cancelCurrentAppointment">å–æ¶ˆé¢„çº¦</button>
                <button class="btn-complete" wx:if="{{currentDetail.zt === 'å¾…æœåŠ¡'}}"
                    bindtap="completeCurrentAppointment">å·²åˆ°åº—</button>
                <button class="btn-complete" wx:if="{{currentDetail.zt === 'æœåŠ¡ä¸­'}}"
                    bindtap="completeAppointment">æœåŠ¡å®Œæˆ</button>
            </view>
        </view>
    </view>

    <!-- æ–°å¢é¢„çº¦å¼¹çª—ç»„ä»¶ -->
    <add-appointment-modal id="addAppointmentModal" staff-list="{{staffList}}" service-options="{{serviceOptions}}"
        bind:confirm="handleAddAppointment" bind:cancel="hideAddModal" />
</view>