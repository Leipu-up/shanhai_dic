<view class="modal-container" wx:if="{{showModal}}">
    <view class="modal-mask" bindtap="handleCancel"></view>

    <view class="modal-content">
        <!-- 标题栏 -->
        <view class="modal-header">
            <text class="modal-title">{{isEdit ? '编辑预约' : '新增预约'}}</text>
            <text class="close-btn" bindtap="handleCancel">×</text>
        </view>

        <scroll-view class="modal-body" scroll-y style="max-height: {{scrollViewHeight}}px">
            <!-- 客户信息 -->
            <view class="form-section">
                <view class="section-title">客户信息</view>

                <view class="form-item">
                    <text class="form-label required">客户姓名</text>
                    <input class="form-input" type="text" placeholder="请输入客户姓名" value="{{formData.name}}"
                        bindinput="onInputChange" data-field="name" maxlength="20" />
                </view>

                <view class="form-item">
                    <text class="form-label required">手机号</text>
                    <input class="form-input" type="number" placeholder="请输入手机号" value="{{formData.phone}}"
                        bindinput="onInputChange" data-field="phone" maxlength="11" />
                </view>
            </view>

            <!-- 预约信息 -->
            <view class="form-section">
                <view class="section-title">预约信息</view>

                <view class="form-item">
                    <text class="form-label required">预约日期</text>
                    <picker mode="date" value="{{formData.appointmentDate}}" bindchange="onDateChange"
                        class="picker-input">
                        <view class="picker-text {{formData.appointmentDate ? '' : 'placeholder'}}">
                            {{formData.appointmentDate || '请选择预约日期'}}
                        </view>
                    </picker>
                </view>

                <view class="form-item">
                    <text class="form-label required">预约时间</text>
                    <picker mode="time" value="{{formData.appointmentTime}}" bindchange="onTimeChange"
                        class="picker-input">
                        <view class="picker-text {{formData.appointmentTime ? '' : 'placeholder'}}">
                            {{formData.appointmentTime || '请选择预约时间'}}
                        </view>
                    </picker>
                </view>

                <view class="form-item">
                    <text class="form-label required">服务时长</text>
                    <picker range="{{durationOptions}}" range-key="name" value="{{durationIndex}}"
                        bindchange="onDurationChange" class="picker-input">
                        <view class="picker-text {{formData.duration ? '' : 'placeholder'}}">
                            {{formData.duration ? formData.duration + '分钟' : '请选择服务时长'}}
                        </view>
                    </picker>
                </view>
            </view>

            <!-- 服务内容 -->
            <view class="form-section">
                <view class="section-title">服务内容</view>

                <view class="form-item">
                    <text class="form-label required">服务项目</text>
                    <picker mode="selector" range="{{serviceOptions}}" range-key="name" value="{{serviceIndex}}"
                        bindchange="onServiceChange" class="picker-input">
                        <view class="picker-text {{formData.service ? '' : 'placeholder'}}">
                            {{formData.service || '请选择服务项目'}}
                        </view>
                    </picker>
                </view>

                <view class="form-item">
                    <text class="form-label required">服务人员</text>
                    <picker mode="selector" range="{{staffOptions}}" range-key="name" value="{{staffIndex}}"
                        bindchange="onStaffChange" class="picker-input" disabled="{{userRole !== 'admin'}}">
                        <view class="picker-text {{formData.staffName ? '' : 'placeholder'}}">
                            {{formData.staffName || (userRole === 'admin' ? '请选择服务人员' : currentUser.nickName)}}
                        </view>
                    </picker>
                    <text class="help-text" wx:if="{{userRole !== 'admin'}}">您只能为自己预约</text>
                </view>
            </view>

            <!-- 备注信息 -->
            <view class="form-section">
                <view class="section-title">备注信息</view>

                <view class="form-item">
                    <text class="form-label">预约备注</text>
                    <textarea class="form-textarea" placeholder="请输入备注信息（最多200字）" value="{{formData.notes}}"
                        bindinput="onTextareaChange" data-field="notes" maxlength="200" />
                    <view class="textarea-counter">
                        <text>{{formData.notes ? formData.notes.length : 0}}/200</text>
                    </view>
                </view>
            </view>
        </scroll-view>

        <!-- 底部按钮 -->
        <view class="modal-footer">
            <button class="btn-cancel" bindtap="handleCancel">取消</button>
            <button class="btn-confirm" bindtap="handleConfirm" disabled="{{!isFormValid}}">确认预约</button>
        </view>
    </view>
</view>