<view class="schedule-page">
    <!-- ç´§å‡‘å‹ç­›é€‰æ  - ä¸‰è¡Œå¸ƒå±€ -->
    <view class="filter-bar compact">
        <!-- ç¬¬ä¸€è¡Œï¼šæ—¥æœŸèŒƒå›´ -->
        <view class="filter-row compact date-row">
            <view class="filter-item date-item">
                <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
                    <view class="date-picker compact">
                        <text class="date-icon">ğŸ“…</text>
                        <text class="date-text">{{startDate ? startDate : 'å¼€å§‹æ—¥æœŸ'}}</text>
                    </view>
                </picker>
            </view>
            <view class="filter-item date-item">
                <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
                    <view class="date-picker compact">
                        <text class="date-icon">ğŸ“…</text>
                        <text class="date-text">{{endDate ? endDate : 'ç»“æŸæ—¥æœŸ'}}</text>
                    </view>
                </picker>
            </view>
        </view>

        <!-- ç¬¬äºŒè¡Œï¼šå‘˜å·¥å’ŒçŠ¶æ€ç­›é€‰ -->
        <view class="filter-row compact select-row">
            <view class="filter-item staff-item">
                <picker mode="selector" range="{{staffOptions}}" range-key="name" value="{{selectedStaffName}}"
                    bindchange="onStaffChange">
                    <view class="filter-select compact">
                        <text class="filter-icon">ğŸ‘©â€ğŸ’¼</text>
                        <text class="filter-text">{{selectedStaffName || 'å…¨éƒ¨å‘˜å·¥'}}</text>
                        <text class="dropdown-arrow">â–¼</text>
                    </view>
                </picker>
            </view>

            <view class="filter-item status-item">
                <picker mode="selector" range="{{statusOptions}}" range-key="name" value="{{selectedStatusIndex}}"
                    bindchange="onStatusChange">
                    <view class="filter-select compact">
                        <text class="filter-icon">ğŸ“Š</text>
                        <text class="filter-text">{{selectedStatusName || 'å…¨éƒ¨çŠ¶æ€'}}</text>
                        <text class="dropdown-arrow">â–¼</text>
                    </view>
                </picker>
            </view>
        </view>

        <!-- ç¬¬ä¸‰è¡Œï¼šæŸ¥è¯¢å’Œé‡ç½®æŒ‰é’® -->
        <view class="filter-row compact button-row">
            <button class="btn-reset original" bindtap="resetFilters">
                <text class="btn-icon">ğŸ”„</text>
                <text class="btn-text">é‡ç½®</text>
            </button>
            <button class="btn-search original" bindtap="refreshScheduleList">
                <text class="btn-icon">ğŸ”</text>
                <text class="btn-text">æŸ¥è¯¢</text>
            </button>
        </view>
    </view>

    <!-- æ’ç­åˆ—è¡¨ -->
    <view class="schedule-list">
        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <view class="stats-info" wx:if="{{scheduleList.length > 0}}">
            <view class="stats-item">
                <text class="stats-number">{{onDutyCount}}</text>
                <text class="stats-label">åœ¨å²—</text>
            </view>
            <view class="stats-item">
                <text class="stats-number">{{offDutyCount}}</text>
                <text class="stats-label">ä¼‘æ¯</text>
            </view>
            <view class="stats-item">
                <text class="stats-number">{{totalAppointments}}</text>
                <text class="stats-label">æ€»é¢„çº¦</text>
            </view>
        </view>

        <!-- æ’ç­è¡¨æ ¼ -->
        <view class="schedule-table" wx:if="{{scheduleList.length > 0}}">
            <!-- è¡¨å¤´ -->
            <view class="table-header">
                <view class="header-cell">å‘˜å·¥å§“å</view>
                <view class="header-cell">åœ¨å²—çŠ¶æ€</view>
                <view class="header-cell">é¢„çº¦å®¢æˆ·æ•°</view>
                <view class="header-cell">æ’ç­æ—¥æœŸ</view>
                <view class="header-cell">æ“ä½œ</view>
            </view>

            <!-- è¡¨æ ¼å†…å®¹ -->
            <view class="table-body">
                <view class="table-row" wx:for="{{scheduleList}}" wx:key="id">
                    <view class="table-cell">
                        <view class="staff-info">
                            <image class="staff-avatar" src="{{'/images/default-avatar.png'}}"></image>
                            <text class="staff-name">{{item.jmygb.nickname}}</text>
                        </view>
                    </view>

                    <view class="table-cell">
                        <view class="status-badge {{item.pblx === 'å…¨å¤©ç­' ? 'on-duty' : 'off-duty'}}">
                            {{item.pblx === 'å…¨å¤©ç­' ? 'åœ¨å²—' : 'ä¼‘æ¯'}}
                        </view>
                    </view>

                    <view class="table-cell">
                        <view class="appointment-count">
                            <text class="count-number">{{item.appointmentCount || 0}}</text>
                            <text class="count-label">äºº</text>
                        </view>
                    </view>

                    <view class="table-cell">
                        <view class="schedule-date">
                            <text class="date-month">{{item.pbrq || '--'}}</text>
                        </view>
                    </view>

                    <view class="table-cell actions">
                        <button class="action-btn edit" size="mini" data-id="{{item.id}}" catchtap="editSchedule">
                            <text class="action-icon">âœï¸</text>
                        </button>
                        <button class="action-btn delete" size="mini" data-id="{{item.id}}" catchtap="deleteSchedule">
                            <text class="action-icon">ğŸ—‘ï¸</text>
                        </button>
                    </view>
                </view>
            </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view wx:else class="empty-state">
            <view class="empty-icon">ğŸ“…</view>
            <text class="empty-text">æš‚æ— æ’ç­ä¿¡æ¯</text>
            <button class="btn-primary" bindtap="showAddModal">æ–°å¢æ’ç­</button>
        </view>

        <!-- åˆ†é¡µåŠ è½½æç¤º -->
        <view class="load-more-container" wx:if="{{scheduleList.length > 0}}">
            <view wx:if="{{loading}}" class="loading-more">
                <view class="loading-spinner"></view>
                <text class="loading-text">æ­£åœ¨åŠ è½½æ›´å¤š...</text>
            </view>

            <!-- ä¿®å¤ï¼šä½¿ç”¨ total è€Œä¸æ˜¯ totalCount -->
            <view wx:elif="{{!hasMore && total > 0}}" class="no-more-data">
                <text class="no-more-text">å·²åŠ è½½å…¨éƒ¨æ’ç­</text>
            </view>

            <view wx:elif="{{hasMore && !loading}}" class="load-more-tip">
                <text class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
            </view>
        </view>
    </view>

    <!-- æ–°å¢æ’ç­æŒ‰é’® -->
    <view class="add-btn-container" wx:if="{{scheduleList.length > 0}}">
        <button class="add-btn" bindtap="showAddModal">
            <text class="add-icon">+</text>
            <text class="add-text">æ–°å¢æ’ç­</text>
        </button>
    </view>

    <!-- æ–°å¢/ç¼–è¾‘æ’ç­å¼¹çª—ç»„ä»¶ -->
    <schedule-modal id="scheduleModal" staff-list="{{staffList}}" bind:confirm="handleScheduleConfirm"
        bind:cancel="hideScheduleModal" />
</view>